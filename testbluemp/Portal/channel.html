<extend name="Public:newbase" />
<block name="main">
	<css file="/Theme/Cloudpark/css/common.css" />
	<css file="/Theme/Cloudpark/css/index.css" />
	<div id="container" class="transparent opacityTrans">
			<header>
				<div id="bodyMask"></div>
				<div id="headerInner">
					<div id="logo" class="none">
						<a href="javascript:;">
							<img src=""/>
						</a>
					</div>
					<div id="title" class="none">
						<a href="javascript:;"></a>
					</div>
					<div id="menuBtn" class="none">
						<div class="menuBar" id="menuBar_1"></div>
						<div class="menuBar" id="menuBar_2"></div>
						<div class="menuBar" id="menuBar_3"></div>
					</div>
				</div>
				<div id="menuWrap">
					<div id="dingyun"></div>
					<div id="menuList">
						<div id="menuListInner">
							<!--<div class="menuItem"><a href="javascript:;">首页</a></div>
							<div class="menuItem"><a href="javascript:;">站内搜索</a></div>
							<div class="menuItem"><a href="javascript:;">留言板</a></div>
							<div class="menuItem"><a href="javascript:;">业务合作</a></div>
							<div class="menuItem"><a href="javascript:;">关于我们</a></div>-->
						</div>
					</div>
				</div>
			</header>
			<section id="main">
				<div id="quan">
					<div id="mainText">
						<div class="textWrap">
							<div id="textBar_1" class="textBar"></div>
							<div id="textBar_2" class="textBar"></div>
							<div id="textBar_3" class="textBar"></div>
							<div id="textBar_4" class="textBar"></div>
							<div id="textBar_5" class="textBar"></div>
							<div id="textBar_6" class="textBar"></div>
						</div>
					</div>
					<div id="icon_2">
						<a href="javascript:;"><div class="icon_inner"></div></a>
					</div>
					<div id="icon_5">
						<a href="javascript:;"><div class="icon_inner"></div></a>
					</div>
				</div>
				<div id="icon_1">
					<a href="javascript:;"><div class="icon_inner"></div></a>
				</div>
				<div id="icon_3">
					<a href="javascript:;"><div class="icon_inner"></div></a>
				</div>
				<div id="icon_4">
					<a href="javascript:;"><div class="icon_inner"></div></a>
				</div>
				<div id="icon_6">
					<a href="javascript:;"><div class="icon_inner"></div></a>
				</div>
				<div id="tv">
					<div id="imgRun">
						<div id="imgRunScroller">
							<!--<a href="http://baidu.com"><div id="runImg_1" class="runImg"></div></a>
							<a href="http://baidu.com"><div id="runImg_1" class="runImg"></div></a>
							<a href="http://baidu.com"><div id="runImg_1" class="runImg"></div></a>-->
						</div>
					</div>
					<div id="starRoate"></div>
				</div>
				<div id="zhongStar_1"></div>
				<div id="zhongStar_2"></div>
				<div id="zhongStar_3"></div>
			</section>
			<section id="list">
				<div id="listInner">
					<div id="listLoading">
						<span class="mui-spinner"></span>
					</div>
					<div id="listTips" class="none">
						暂无新闻
					</div>
					<!--<div class="row hot" id="row_1">
						<div class="rowLeft"><a href="http://www.163.com">热点直击</a></div>
						<div class="rowMiddle">沈鉄梅当选中国剧协副主席</div>
						<div class="rowRight">2016-04-15</div>
					</div>
					<div class="row hot">
						<div class="rowLeft">热点直击</div>
						<div class="rowMiddle">权志龙”苹果脸“-Fan权志龙”苹果脸“-Fan权志龙”苹果脸“-Fan</div>
						<div class="rowRight">2016-02-03</div>
					</div>
					<div class="row new">
						<div class="rowLeft">文化信息娱乐</div>
						<div class="rowMiddle">《上海传奇》全国首映礼</div>
						<div class="rowRight">2016-01-11</div>
					</div>
					<div class="row">
						<div class="rowLeft">娱乐</div>
						<div class="rowMiddle">《非诚勿扰》整改增党校教</div>
						<div class="rowRight">2015-12-05</div>
					</div>
					<div class="row">
						<div class="rowLeft">新鲜事</div>
						<div class="rowMiddle">跟着小S跳出"撩人"好身材</div>
						<div class="rowRight">2015-04-15</div>
					</div>-->
				</div>
			</section>
			<footer>
				<div id="diStar_1"></div>
				<div id="diStar_2"></div>
				<div id="diStar_3"></div>
				<div id="diyun"></div>
				<div id="copyright">版权所有©BlueMP技术支持</div>
			</footer>
		</div>
	<js file="/Theme/Cloudpark/js/zepto.min.js" />
	<js file="/Theme/Cloudpark/js/iscroll.js" />
	<js file="/Theme/Cloudpark/js/common.js" />
	
	<script>
		document.onselectstart = new Function('event.returnValue=false;');
			var pages = [
				{pos0:'对对对',pos1:'对对对',pos2:'对对对',pos3:'对对对',pos4:'对对对',pos5:'对对对',pos6:'对对对'}
			];
			var word = [5,9,11,11,9,5];
			var reg = /[\u0000-\u00FF]/;
			$(function(){
				//setTimeout(function(){
					layout();
					new bluemp.block.breadcrumb({
						type:1,
						isDefault: false,
						fnSuccess: function(data) {
							console.log(data);
							if(data && data.index_href){
								$('#logo a,#title a').attr('href',data.index_href);
							}
						}
					});
					initExtendInfo();
					initTitle();
					
					new bluemp.block.banner({
						isDefault: false,
						fnSuccess: function(data) {
							var dBanner = data.carouselpic;
							var imgRunScroller = $('#imgRunScroller');
							if (dBanner && dBanner.length > 0) {
								for (var i = 0; i < dBanner.length; i++) {
									var imgEle = $('<div class="runImg"></div>').css('background-image','url('+dBanner[i].pic+')');
									var aEle = $('<a href="'+dBanner[i].url+'"></a>').append(imgEle);
									imgRunScroller.append(aEle);
								}
								if(dBanner.length>1){
									var imgs = $('.runImg');
									imgH = imgs.eq(0).height();
									imgWrap = $('#imgRunScroller');
									imgN = imgs.length;
									imgWrapH = imgN*imgH;
									imgWrap.height(imgWrapH);
									imgRun();
								}
							}else{
								imgRunScroller.append('<div class="runImg default"></div>');
							}
						}
					});
					
					new bluemp.block.mainNav({
						isDefault: false,
						fnSuccess: function(data) {
							for (var i = 0; i < data.length; i++) {
								if(i>5){
									break;
								}
								var icon = $('#icon_'+(i+1)),
									aEle = icon.find('a'),
									iconEle = icon.find('.icon_inner');
								var dI = data[i],
									name = dI.name,
									url = dI.url,
									pic = dI.pic;
								aEle.attr('href',url);
								if (pic) {
									iconEle.css('background-image','url('+pic+')');
								} else {
									var words = [];
									var n = 0;
									for(var n=0;n<name.length;n++){
										var c = name.charAt(n);
										if(!reg.test(c)){
											words.push(c);
										}else{
											if(n==name.length-1){
												words.push(c);
											}else{
												var next = name.charAt(++n);
												if(!reg.test(next)){
													words.push(c);
													words.push(next);
												}else{
													words.push(c+next);
												}
											}
										}
									}
									var len = words.length, str = '';
									if(len == 1){
										str = words[0];
										iconEle.addClass('oneWord');
									}else if(len == 2){
										str = words[0]+words[1];
										iconEle.addClass('twoWord');
									}else if(len == 3){
										str = words[0]+words[1]+'<br/>'+words[2];
									}else if(len == 4){
										str = words[0]+words[1]+'<br/>'+words[2]+words[3];
									}else if(len > 4){
										str = words[0]+words[1]+'<br/>'+words[2]+'...';
									}
									iconEle.html(str);
								}
							}
							
							if(isAndroid){
								$('#icon_1 .icon_inner').css('padding','.4rem');
								$('#icon_2 .icon_inner').css('padding','.41rem');
								$('#icon_3 .icon_inner').css('padding','.5rem');
								$('#icon_4 .icon_inner').css('padding','.45rem');
								$('#icon_5 .icon_inner').css('padding','.31rem');
								$('#icon_6 .icon_inner').css('padding','.41rem');
								
								$('#icon_1 .icon_inner.oneWord').css('padding-top','.65rem');
								$('#icon_2 .icon_inner.oneWord').css('padding-top','.67rem');
								$('#icon_3 .icon_inner.oneWord').css('padding-top','.71rem');
								$('#icon_4 .icon_inner.oneWord').css('padding-top','.73rem');
								$('#icon_5 .icon_inner.oneWord').css('padding-top','.67rem');
								$('#icon_6 .icon_inner.oneWord').css('padding-top','.75rem');
								
								$('#icon_1 .icon_inner.twoWord').css('padding-top','.75rem');
								$('#icon_2 .icon_inner.twoWord').css('padding-top','.8rem');
								$('#icon_3 .icon_inner.twoWord').css('padding-top','.83rem');
								$('#icon_4 .icon_inner.twoWord').css('padding-top','.85rem');
								$('#icon_5 .icon_inner.twoWord').css('padding-top','.7rem');
								$('#icon_6 .icon_inner.twoWord').css('padding-top','.76rem');
							}
						}
					});
					
					var channelCnt = 0, arts = [], timeout1 = 5000, timeout2 = 55000, channelLoadedCnt = 0;
					function bulitList(){
						$('#listLoading').addClass('none');
						var len = arts.length;
						if(len==0){
							$('#listTips').removeClass('none');
						}else{
							var hotCnt = 2, newCnt = 3;
							hotCnt = hotCnt>len?len:hotCnt;
							for(var k=0;k<hotCnt;k++){
								for(var i=len-1;i>k;i--){
									if(arts[i].pv>arts[i-1].pv){
										var temp = arts[i-1];
										arts[i-1] = arts[i];
										arts[i] = temp;
									}
								}
							}
							var arry = [];
							for(var k=0;k<hotCnt;k++){
								if(arts[0].pv>0){
									arry.push({data:arts.splice(0,1)[0],type:'hot'});
								}
							}
							var hotCntLen = arry.length;
							newCnt += 2-hotCntLen;
							newCnt = (hotCntLen + newCnt)>len?(len-hotCntLen):newCnt;
							console.log(hotCntLen,newCnt);
							for(var k=0;k<newCnt;k++){
								for(var i=arts.length-1;i>k;i--){
									if(arts[i].updatetime>arts[i-1].updatetime){
										var temp = arts[i-1];
										arts[i-1] = arts[i];
										arts[i] = temp;
									}
								}
							}
							for(var k=0;k<newCnt;k++){
								arry.push({data:arts.splice(0,1)[0],type:'new'});
							}
							var listInner = $('#listInner');
							for(var i=0;i<arry.length;i++){
								var ai = arry[i],
									data = ai.data,
									type = ai.type;
								rowLinks.push(data.href);
								var rowEle = $('<div class="row '+type+'" id="row_'+i+'" >'+
													'<div class="rowLeft" id="chl_'+i+'_'+data.cid+'" >'+data.name+'</div>'+
													'<div class="rowMiddle">'+data.title+'</div>'+
													'<div class="rowRight">'+formatDate(data.updatetime)+'</div>'+
												'</div>'); 
								listInner.append(rowEle);
							}
							listInner.on('click','.row',function(){
								window.location.href = rowLinks[parseInt($(this).attr('id').replace('row_',''))];
							});
							/*listInner.on('click','.rowLeft',function(){
								window.event.stopPropagation();
								console.log($(this).attr('id').split('_')[2]);
								sessionStorage.cid = $(this).attr('id').split('_')[2];
								var link;
								if(testMode){
									link = 'list.html';
								}else{
									link = '/Portal/articlelist.html';
								}
								window.location.href = link;
							});*/
						}
					}
					var rowLinks = [];
					new bluemp.block.channelList({
						isDefault: false,
						fnSuccess: function(data) {
							console.log('channelList:');
							console.log(data);
							channelCnt = data.length;
							if(channelCnt<=0){
								$('#listLoading').addClass('none');
								$('#listTips').removeClass('none');
								return;
							}
							setTimeout(function(){
								if(channelLoadedCnt < channelCnt){
									if(channelLoadedCnt == 0){
										setTimeout(function(){
											$('#listLoading').addClass('none');
											$('#listTips').removeClass('none');
										},timeout2);
									}else{
										bulitList();
									}
								}
							},timeout1);
							for (var i = 0; i < channelCnt; i++) {
								var di = data[i],
									channelId = di.id;
								bluemp_cid = channelId;
								new bluemp.block.articleList({
									isDefault: false,
									fnSuccess: function(d) {
										channelLoadedCnt++;
										if(d && d.length>0){
											console.log(d.length);
											arts = arts.concat(d);
										}
										if(channelLoadedCnt==channelCnt){
											bulitList();
										}
									}
								});
							}
						}
					});
					
					$('#container').removeClass('transparent');
					initHeader();
					
					var mainText = '';
					var meta = document.getElementsByTagName('meta');
					for(i in meta){
						if(typeof meta[i].name!="undefined"&&meta[i].name.toLowerCase()=="description"){
							var desc = meta[i].content;
							if(trim(desc)!=''){
								mainText = desc;
							}
						}
					}
					if(mainText==''){
						$('#mainText').addClass('noInfo');
					}else{
						initTextRun(mainText);
					}
			//	},1000);
			});
			function initTextRun(mainText){
				var len = mainText.length;
				if(len>0){
					pages = [];
					var i = 0;
					while(i<len){
						var page = {};
						for(var j=0;j<word.length;j++){
							if(i>=len){
								page[j] = '';
							}else{
								var charArry = [], byteLen = 0;
								while(byteLen/2 <= word[j]-1){
									var c = mainText.charAt(i++);
									charArry.push(c);
									if(reg.test(c)){
										byteLen++;
									}else{
										byteLen += 2;
									}
								}
								page[j] = charArry.join('');
							}
						}
						if(page != {}){
							pages.push(page);
						}
					}
					bars = $('.textBar');
					var page0 = pages[0];
					for(var i=0;i<bars.length;i++){
						var str = page0[i];
						if(!str || str.length<=0){
							str = '';
						}
						bars.eq(i).html(str);
					}
					pSize = pages.length;
					if(pSize>1){
						setInterval(function(){
							changePage2();
						},8000);
					}
				}
			}
			function changePage2(){
				$('.textWrap.old').remove();
				$('.textWrap').addClass('transparent');
				var copy = $('.textWrap').clone();
				$('.textWrap').addClass('old');
				barTimer = setTimeout(function(){
								var copyBars = copy.find('.textBar');
								pageIdx = pageIdx>=pSize-1?0:pageIdx+1;
								var nextPage = pages[pageIdx];
								for(var i=0;i<copyBars.length;i++){
									var str = nextPage[i];
									if(!str || str.length<=0){
										str = '';
									}
									copyBars.eq(i).html(str);
								}
								$('#mainText').append(copy);
								var ti = setTimeout(function(){
									copy.removeClass('transparent');
									clearTimeout(ti);
								},100);
								
								clearTimeout(barTimer);
						   },1100);
				
			}
			var pageIdx = 0, barTimer, pSize;
			
			var winW, rfSize = 40;
			var imgWrap,imgWrapH,imgH,imgN,step = 2,timer;
			function layout(){
				updateSize();
				var imgs = $('.runImg');
				if(imgs.length>1){
					imgH = imgs.eq(0).height();
					imgWrap = $('#imgRunScroller');
					imgN = imgs.length;
					imgWrapH = imgN*imgH;
					imgWrap.height(imgWrapH);
					clearTimeout(timer);
					imgRun();
				}
			}
			function imgRun(){
				var t = px2Int(imgWrap.css('top'));
				timer = setTimeout(function(){
							if(t<-imgH){
								imgWrap.append($('.runImg').eq(0));	
								imgWrap.css('top',t+imgH-step);
							}else{
								imgWrap.css('top',t-step);
							}
							imgRun();
						},50);
			}
	</script>
</block>